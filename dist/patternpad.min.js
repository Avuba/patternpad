!function(t,e,s){"use strict";t.PatternPad=e.Class("PatternPad");var i={};i.getDistance=function(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},i.getAngle=function(t,e){return 180*Math.atan2(e.y-t.y,e.x-t.x)/Math.PI},i.doesLineIntersectCircle=function(t,e,s){var n={length:i.getDistance(t,e),direction:{}};n.direction.x=(e.x-t.x)/n.length,n.direction.y=(e.y-t.y)/n.length;var o={t:n.direction.x*(s.x-t.x)+n.direction.y*(s.y-t.y)};o.x=o.t*n.direction.x+t.x,o.y=o.t*n.direction.y+t.y;var c=i.getDistance(s,o);if(c<s.radius){var r=Math.sqrt(Math.pow(s.radius,2)-Math.pow(c,2)),a={x:(o.t-r)*n.direction.x+t.x,y:(o.t-r)*n.direction.y+t.y},h={x:(o.t+r)*n.direction.x+t.x,y:(o.t+r)*n.direction.y+t.y};if(n.length>=i.getDistance(t,a)){var l=i.getAngle(t,e)>0?1:-1,p=i.getAngle(t,a)>0?1:-1;if(l===p)return!0}else if(n.length>=i.getDistance(t,h)){var l=i.getAngle(t,e)>0?1:-1,u=i.getAngle(t,h)>0?1:-1;if(l===u)return!0}else if(i.getDistance(t,s)<s.radius||i.getDistance(e,s)<s.radius)return!0;return!1}return!1},PatternPad.Fragment({name:"line",EVENTS:{line:{start:"line:start",hit:"line:hit",end:"line:end"}},scope:{line:{currentDot:null,currentSegment:{start:{x:0,y:0},end:{x:0,y:0},$elem:null},$segments:[]},multipleHits:!1,pattern:[]},hooks:{onInit:function(){this.scope.$container=$(this.scope.container),this.scope.containerOffset=this.scope.$container.offset(),this._listen(this.scope.container,"touchstart",this._onTouchStart),this._listen(this.scope.container,"touchmove",this._onTouchMove),this._listen(this.scope.container,"touchend",this._onTouchEnd),this._listen(this.scope.container,"touchcancel",this._onTouchCancel)}},methods:{_onTouchStart:function(t){t.preventDefault(),this.refresh(),t.data&&t.data.isSimulated?this._startLine(t.data.touches[0].pageX,t.data.touches[0].pageY):this._startLine(t.touches[0].pageX,t.touches[0].pageY),this._checkForIntersection(),this._dispatch(this.EVENTS.line.start)},_onTouchMove:function(t){t.preventDefault(),t.data&&t.data.isSimulated?this._updateLine(t.data.touches[0].pageX,t.data.touches[0].pageY):this._updateLine(t.touches[0].pageX,t.touches[0].pageY),this._checkForIntersection()},_onTouchEnd:function(t){t.preventDefault(),this.scope.line.$segments[this.scope.line.$segments.length-1].addClass("is-last"),this._dispatch(this.EVENTS.line.end,{pattern:fUtils.fastCloneArray(this.scope.pattern)})},_onTouchCancel:function(t){t.preventDefault()},_startLine:function(t,e){this.scope.line.currentSegment.start.x=t,this.scope.line.currentSegment.start.y=e,this.scope.line.currentSegment.end.x=t+1,this.scope.line.currentSegment.end.y=e+1;var s=this.scope.line.$segments.length<1;this.scope.line.currentSegment.$elem=$('<div         class="line'+(s?" is-first":"")+'" style="         left:'+(this.scope.line.currentSegment.start.x-this.scope.containerOffset.left)+"px;         top:"+(this.scope.line.currentSegment.start.y-this.scope.containerOffset.top)+'px;         "></div>'),this.scope.$container.append(this.scope.line.currentSegment.$elem),this.scope.line.$segments.push(this.scope.line.currentSegment.$elem)},_updateLine:function(t,e){this.scope.line.currentSegment.end.x=t,this.scope.line.currentSegment.end.y=e,this.scope.line.currentSegment.$elem.css({width:i.getDistance(this.scope.line.currentSegment.start,this.scope.line.currentSegment.end)+"px",transform:"rotate("+i.getAngle(this.scope.line.currentSegment.start,this.scope.line.currentSegment.end)+"deg) translateY(-50%)"})},_resetLine:function(){for(var t=this.scope.line.$segments.length,e=0;t>e;e++)this.scope.line.$segments[e].remove();this.scope.line.$segments.length=0},_checkForIntersection:function(){for(var t=this.scope.dotCollection.length,e=[],s=0;t>s;s++){var n=this.scope.dotCollection[s];n.isActive||!this.scope.multipleHits&&n.numberOfHits>0||i.doesLineIntersectCircle(this.scope.line.currentSegment.start,this.scope.line.currentSegment.end,n)&&(n.isActive=!0,n.numberOfHits++,n.distanceToLineStart=i.getDistance(this.scope.line.currentSegment.start,n),n.$elem.addClass("active"),e.push(n))}var o=e.length;if(o){e.sort(function(t,e){return t.distanceToLineStart-e.distanceToLineStart});for(var s=0;o>s;s++){var n=e[s];this._updateLine(n.x,n.y),this._startLine(n.x,n.y),this.scope.pattern.push(n.value),this._dispatch(this.EVENTS.line.hit,{pattern:fUtils.fastCloneArray(this.scope.pattern),value:n.value})}var c=e[o-1];this.scope.line.currentDot&&(this.scope.line.currentDot.isActive=!1),this.scope.line.currentDot=c}}}}),PatternPad.Fragment({name:"dots",scope:{columns:3,rows:3,dotCollection:[],containerOffset:{},resize:{timeout:null,isFirstEvent:!0}},hooks:{onInit:function(){this._drawDots(),this._updateDotCollection(),this._listen(t,"resize",this._onWindowResize)}},methods:{refresh:function(){this._resetDotValues(),this._resetDotElems(),this._resetLine(),this.scope.pattern.length=0,this.scope.containerOffset=this.scope.$container.offset(),this._updateDotCollection()},_drawDots:function(){for(var t=100/this.scope.columns,e=100/this.scope.rows,s=t/2,i=e/2,n=0;n<this.scope.rows;n++)for(var o=0;o<this.scope.columns;o++){var c=$(this.scope.dot);c.css({left:s+t*o+"%",top:i+e*n+"%"}),this.scope.dotCollection.push({$elem:c}),this.scope.$container.append(c)}},_updateDotCollection:function(){if(this.scope.dotCollection[0])for(var t=this.scope.$container.width(),e=this.scope.$container.height(),s=t/this.scope.columns,i=e/this.scope.rows,n=s/2,o=i/2,c=this.scope.dotCollection[0].$elem.width()/2,r=0,a=0;a<this.scope.rows;a++)for(var h=0;h<this.scope.columns;h++){var l=this.scope.dotCollection[r];l.x=this.scope.containerOffset.left+n+s*h,l.y=this.scope.containerOffset.top+o+i*a,l.radius=c,l.isActive=!1,l.numberOfHits=0,l.value=r+1,r++}},_resetDotValues:function(){for(var t=this.scope.dotCollection.length,e=0;t>e;e++){var s=this.scope.dotCollection[e];s.isActive=!1,s.numberOfHits=0}},_resetDotElems:function(){for(var t=this.scope.dotCollection.length,e=0;t>e;e++){var s=this.scope.dotCollection[e];s.$elem.removeClass("active")}},_onWindowResize:function(t){this.scope.resize.isFirstEvent&&(this._resetDotValues(),this._resetDotElems(),this._resetLine(),this.scope.pattern.length=0,this.scope.resize.isFirstEvent=!1),this.scope.resize.timeout&&clearTimeout(this.scope.resize.timeout),this.scope.resize.timeout=setTimeout(function(){this._updateDotCollection(),this.scope.resize.isFirstEvent=!0}.bind(this),150)}}})}(window,window.fragmental);